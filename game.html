<!DOCTYPE html>
<html lang="lt">
<meta charset="utf8">
<head>

</head>
<body>
<canvas id="myCanvas" width="600" height="600" style="background-color: #444444; border: 2px solid #ff3300"></canvas>
<button id="start" onclick="startas()"> Pradedam :)</button>
<button id="stop" onclick="pabaiga()"> Pabaiga</button>

<script>
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var keys = []; // W:87 S:83 A:65 D:68
    var tileSize = canvas.width / 40;
    var score = 0;
    var direction = {x: 1, y: 0};
    var snake = [{x: 2, y: 0}, {x: 1, y: 0}, {x: 0, y: 0}];
    var apple = {x: (parseInt(Math.random() * 40)), y: (parseInt(Math.random() * 40))};

    document.addEventListener('keydown', function (e) {
        keys[e.keyCode] = true;
    }, true);

    document.addEventListener('keyup', function (e) {
        delete keys[e.keyCode];
    }, true);

    setInterval(control, 1000 / 50)

    function control() {

        if ((keys[37] || keys[65]) && direction.x == 0) {
            direction = {x: -1, y: 0};
        } else if ((keys[38] || keys[87]) && direction.y == 0) {
            direction = {x: 0, y: -1};
        } else if ((keys[39] || keys[68]) && direction.x == 0) {
            direction = {x: 1, y: 0};
        } else if ((keys[40] || keys[83]) && direction.y == 0) {
            direction = {x: 0, y: 1};
        }
    }

    function pabaiga() {
        document.location.reload(true);
        alert('Tikiuosi buvo smagu :)')
    }

    function startas() {
        setInterval(update, 1000 / 12)

        function update() {

            for (var i = snake.length - 1; i > 0; i--) {
                snake[i].x = snake[i - 1].x;
                snake[i].y = snake[i - 1].y;
            }

            snake[0].x += direction.x;
            snake[0].y += direction.y;

            if (snake[0].x == apple.x && snake[0].y == apple.y) {
                score++;
                apple.x = parseInt(Math.random() * 40);
                apple.y = parseInt(Math.random() * 40);
                snake.push({x: snake[snake.length - 1].x, y: snake[snake.length - 1].y});
            }

            for (var i = 1; i < snake.length; i++) {
                if (snake[0].x == snake[i].x && snake[0].y == snake[i].y) {
                    window.location.reload(false);
                    alert('Susivalgei.. :( pradėk iš naujo.');
                    break;
                }

                if (snake[0].x > 39 || snake[0].y > 39 || snake[0].x < 0 || snake[0].y < 0) {
                    window.location.reload(false);
                    alert('Atsitrenkei į sieną.. pradėk iš naujo.');
                    break;
                }
            }

            context.clearRect(0, 0, canvas.width, canvas.height);

            context.fillStyle = 'orange';
            context.font = '20px Arial';
            context.fillText('Total: ' + score, 5, 30);


            context.fillStyle = 'green';
            for (var i = 0; i < snake.length; i++) {
                context.fillRect((snake[i].x * tileSize), (snake[i].y * tileSize), tileSize, tileSize);

            }

            context.fillStyle = 'darkgreen';
            for (var i = 0; i < snake.length; i++) {
                context.fillRect((snake[0].x * tileSize), (snake[0].y * tileSize), tileSize, tileSize);

            }

            context.fillStyle = 'red';
            context.fillRect((apple.x * tileSize), (apple.y * tileSize), tileSize, tileSize);
        }
    }


    console.log("helloooo")
</script>
</body>
</html>